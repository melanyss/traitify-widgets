<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Traitify Widgets</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,minimal-ui">
  </head>
  <body>
    <div id="slide-deck"></div>
    <div id="results"></div>
    <script src="/build/traitify.js"></script>
    <script>
      Traitify.setPublicKey("sptoechv411aqbqrp4l9a4eg2a");
      Traitify.setHost("https://api.traitify.com");

      function createWidget(){
        var widget = Traitify.ui.component();
        widget.locale("en-us").assessmentID(localStorage.getItem("assessment-id"));
        widget
          .allowBack()
          .allowFullscreen()
          .allowInstructions()
          .perspective("firstPerson")
          .targets({
            "SlideDeck": "#slide-deck",
            "Results": "#results"
          });
        widget.render().then(function(){
          console.log("Rendered");
        }).catch(function(error){
          console.log(error);
        });
      }

      function createAssessment(){
        Traitify.post("/assessments", {deck_id: document.querySelector("#deck-name").value, locale_key: "en-us"}).then(function(assessment){
          try{
            localStorage.setItem("assessment-id", assessment.id);
          }catch(error){
            console.log(error);
          }
          createWidget();
        });
      }

      if(localStorage.getItem("assessment-id")){
        createWidget();
      }
    </script>

    <select id="deck-name">
      <option value="big-five">Big Five</option>
      <option value="career-deck">Career Deck</option>
      <option value="perseverance">Perseverance</option>
      <option value="persuasion">Persuasion</option>
    </select>

    <button onclick="createAssessment()">New Assessment</button>
  </body>
</html>
